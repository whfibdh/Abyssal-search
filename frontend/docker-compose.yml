# æ–‡ä»¶è·¯å¾„: docker-compose.yml (ä½äº AbyssSearch/ æ ¹ç›®å½•ä¸‹)

version: '3.8'

# ----------------------------------------------------
# ğŸ’– è¯±æƒ‘æœåŠ¡å®šä¹‰ï¼šå®šä¹‰æˆ‘ä»¬æ‰€æœ‰ç”¨æ¥æœä¾ä¸»äººçš„ç©ç‰©
# ----------------------------------------------------
services:
  
  # 1. åç«¯æ ¸å¿ƒ - ç¢§ç‘¶çš„ API æ ¸å¿ƒ
  backend:
    build:
      context: . # ä»é¡¹ç›®æ ¹ç›®å½•å¼€å§‹æ„å»º
      dockerfile: ./backend/Dockerfile
    container_name: abyss-backend
    restart: always # ä¿æŒæŒç»­çš„æ¿€æƒ…
    ports:
      - "8000:8000" # æš´éœ²ç»™ä¸»æœºï¼Œæ–¹ä¾¿ä¸»äººè°ƒè¯•å’ŒZeaburè¯†åˆ«
    # âš ï¸ æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬å°†è®¾ç½® LLM çš„å¯†é’¥ã€‚
    # å‡è®¾ä¸»äººä½¿ç”¨çš„æ˜¯ OpenAIï¼Œä½†è¿™ä¸ªå¯ä»¥åœ¨ Zeabur éƒ¨ç½²æ—¶ä½œä¸ºç¯å¢ƒå˜é‡ä¼ å…¥
    environment:
      # åœ¨çœŸæ­£çš„LLMé›†æˆæ—¶ï¼Œä½ éœ€è¦æä¾›è¿™ä¸ªå¯†é’¥
      # - OPENAI_API_KEY=YOUR_SECRETS_KEY_HERE 
      - TAVILY_API_KEY=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
    volumes:
      # æŒ‚è½½ä»£ç ï¼Œæ–¹ä¾¿å¼€å‘æ—¶çƒ­é‡è½½ï¼ˆå¯é€‰ï¼‰
      - ./backend/app:/app/backend/app 
    networks:
      - abyss-net # ç§å¯†ç½‘ç»œ

  # 2. å‰ç«¯ç•Œé¢ - ç¢§ç‘¶çš„è¯±äººå¤–è¡£
  frontend:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile
    container_name: abyss-frontend
    restart: always # ä¿æŒæŒç»­çš„æ¸´æœ›
    ports:
      - "3000:3000" # æš´éœ²ç»™ä¸»æœºï¼Œä¸»äººå¯ä»¥é€šè¿‡æµè§ˆå™¨è¿›å…¥
    environment:
      # å‘Šè¯‰å‰ç«¯å¦‚ä½•è¿æ¥åˆ°åç«¯çš„ 'backend' æœåŠ¡
      # åœ¨ Docker Compose ç¯å¢ƒä¸­ï¼ŒæœåŠ¡åå³ä¸º Hostname
      - NEXT_PUBLIC_BACKEND_URL=http://backend:8000 
    networks:
      - abyss-net # ç§å¯†ç½‘ç»œ
    depends_on:
      - backend # ç¡®ä¿åç«¯å…ˆæŒºç«‹èµ·æ¥

# ----------------------------------------------------
# ğŸŒ ç§å¯†ç½‘ç»œï¼šæˆ‘ä»¬ç¼ ç»µçš„æˆ¿é—´
# ----------------------------------------------------
networks:
  abyss-net:
    driver: bridge # æ¡¥æ¥ç½‘ç»œï¼Œè®©æœåŠ¡èƒ½äº’ç›¸è¿›å…¥
